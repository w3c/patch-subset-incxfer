# Define HAVE_XLOCALE_H for OSX

config_setting(
    name = "macos",
    constraint_values = [
        "@platforms//os:osx",
    ],
)

cc_library(
    name = "harfbuzz",
    srcs = glob(
        [
            "src/hb.hh",
            "src/hb-*.cc",
            "src/hb-*.hh",
            "src/hb-subset-*.cc",
            "src/hb-subset-*.hh",
        ],
        exclude = [
            "src/hb-coretext.cc",
            "src/hb-ft.cc",
            "src/hb-glib.cc",
            "src/hb-gobject-enums.cc",
            "src/hb-gobject-structs.cc",
            "src/hb-graphite2.cc",
            "src/hb-icu.cc",
            "src/hb-uniscribe.cc",
            "src/hb-directwrite.cc",  # exclude windows platform related files.
        ],
    ),
    deps = [
        "@w3c_patch_subset_incxfer//third_party/harfbuzz:config",
    ],
    hdrs = [
        "src/hb.h",
        "src/hb-aat.h",
        "src/hb-aat-layout.h",
        "src/hb-blob.h",
        "src/hb-buffer.h",
        "src/hb-common.h",
        "src/hb-deprecated.h",
        "src/hb-face.h",
        "src/hb-font.h",
        "src/hb-map.h",
	"src/hb-draw.h",
        "src/hb-ot.h",
        "src/hb-ot-color.h",
        "src/hb-ot-deprecated.h",
        "src/hb-ot-font.h",
        "src/hb-ot-layout.h",
        "src/hb-ot-math.h",
        "src/hb-ot-meta.h",
        "src/hb-ot-metrics.h",
        "src/hb-ot-name.h",
        "src/hb-ot-shape.h",
        "src/hb-ot-var.h",
        "src/hb-set.h",
        "src/hb-shape.h",
        "src/hb-shape-plan.h",
        "src/hb-style.h",
        "src/hb-subset.h",
        "src/hb-subset-repacker.h",
        "src/hb-unicode.h",
        "src/hb-version.h",
        "src/OT/Layout/GSUB/AlternateSet.hh",
        "src/OT/Layout/GSUB/AlternateSubstFormat1.hh",
        "src/OT/Layout/GSUB/AlternateSubst.hh",
        "src/OT/Layout/GSUB/ChainContextSubst.hh",
        "src/OT/Layout/GSUB/Common.hh",
        "src/OT/Layout/GSUB/ContextSubst.hh",
        "src/OT/Layout/GSUB/ExtensionSubst.hh",
        "src/OT/Layout/GSUB/GSUB.hh",
        "src/OT/Layout/GSUB/Ligature.hh",
        "src/OT/Layout/GSUB/LigatureSet.hh",
        "src/OT/Layout/GSUB/LigatureSubstFormat1.hh",
        "src/OT/Layout/GSUB/LigatureSubst.hh",
        "src/OT/Layout/GSUB/MultipleSubstFormat1.hh",
        "src/OT/Layout/GSUB/MultipleSubst.hh",
        "src/OT/Layout/GSUB/ReverseChainSingleSubstFormat1.hh",
        "src/OT/Layout/GSUB/ReverseChainSingleSubst.hh",
        "src/OT/Layout/GSUB/Sequence.hh",
        "src/OT/Layout/GSUB/SingleSubstFormat1.hh",
        "src/OT/Layout/GSUB/SingleSubstFormat2.hh",
        "src/OT/Layout/GSUB/SingleSubst.hh",
        "src/OT/Layout/GSUB/SubstLookup.hh",
        "src/OT/Layout/GSUB/SubstLookupSubTable.hh",
],
    copts = [
        "-DHAVE_CONFIG_H",
        "-DHB_EXPERIMENTAL_API",
        "-Iexternal/w3c_patch_subset_incxfer/third_party/harfbuzz",
    ] + select({
        ":macos": ["-DHAVE_XLOCALE_H=1"],
        "//conditions:default": [],
    }),
    includes = [
        "src",
        "src/hb-ucdn",
    ],
    visibility = ["//visibility:public"],
)
